<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{index :: head}">
  <meta charset="UTF-8">
  <title>Instituto Mário Gazin - Projetos</title>
</head>
<body>

<div th:replace="~{index :: sidebar}"></div>

<div class="main-content">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 th:text="${projeto.id != null} ? 'Editar Projeto' : 'Novo Projeto'">Novo Projeto</h2>

    <a th:if="${projeto.id != null}"
       th:href="@{'/vinculo-projeto-turma/projeto/' + ${projeto.id}}"
       class="btn btn-info text-white">
      <i class="bi bi-people-fill me-2"></i> Gerenciar Turmas
    </a>
  </div>

  <form th:action="@{/projetos/salvar}"
        th:object="${projeto}"
        method="post"
        enctype="multipart/form-data"
        class="card p-4 shadow-sm border-0">

    <input type="hidden" th:field="*{id}"/>

    <div class="mb-4">
      <label for="nomeProjeto" class="form-label fw-bold">Nome do Projeto</label>
      <input type="text"
             class="form-control"
             id="nomeProjeto"
             th:field="*{nomeProjeto}"
             placeholder="Ex: Feira de Ciências 2025"
             required
             th:classappend="${#fields.hasErrors('nomeProjeto')} ? 'is-invalid' : ''">
      <div class="invalid-feedback" th:errors="*{nomeProjeto}"></div>
    </div>

    <div class="mb-4">
      <label for="documentosFiles" class="form-label fw-bold">
        <i class="bi bi-paperclip"></i> Anexar Documentos
      </label>
      <input class="form-control"
             type="file"
             id="documentosFiles"
             name="documentosFiles"
             multiple>
      <div class="form-text text-muted">
        Selecione um ou mais arquivos para adicionar ao projeto (PDF, Docx, Imagens).
      </div>
    </div>

    <div class="d-flex gap-2">
      <button type="submit" class="btn btn-success">
        <i class="bi bi-check-lg"></i> Salvar Projeto
      </button>
      <a th:href="@{/projetos}" class="btn btn-secondary">Cancelar</a>
    </div>
  </form>

  <div th:if="${projeto.id != null and not #lists.isEmpty(projeto.documentos)}" class="mt-5">
    <h4 class="border-bottom pb-2 mb-3">Documentos Anexados</h4>

    <div class="list-group shadow-sm">
      <div class="list-group-item d-flex justify-content-between align-items-center"
           th:each="doc : ${projeto.documentos}">

        <div class="d-flex align-items-center">
          <div class="me-3 text-primary fs-4">
            <i class="bi bi-file-earmark-text"></i>
          </div>
          <div>
            <h6 class="mb-0" th:text="${doc.nomeArquivo}">Arquivo.pdf</h6>
            <small class="text-muted" th:text="${doc.tipoArquivo}">application/pdf</small>
          </div>
        </div>

        <div>
          <a th:href="@{/uploads/{filename}(filename=${doc.urlArquivo})}"
             target="_blank"
             class="btn btn-sm btn-outline-primary me-1"
             title="Baixar">
            <i class="bi bi-download"></i>
          </a>
          <a th:href="@{'/projetos/documento/deletar/' + ${doc.id}}"
             class="btn btn-sm btn-outline-danger"
             onclick="return confirm('Tem certeza que deseja excluir este documento permanentemente?');"
             title="Excluir">
            <i class="bi bi-trash"></i>
          </a>
        </div>
      </div>
    </div>
  </div>

</div>

<script th:src="@{/js/sidebar-toggle.js}"></script>
</body>
</html>