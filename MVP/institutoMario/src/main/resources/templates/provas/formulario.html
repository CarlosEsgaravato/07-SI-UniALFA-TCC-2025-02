<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head th:replace="index :: head">
    <meta charset="UTF-8">
    <title th:text="Hackathon - Questões"></title>
</head>
<body>

<div th:replace="index :: sidebar"></div>

<div class="main-content">
    <h2 th:text="${prova.id != null} ? 'Editar Prova' : 'Nova Prova'">Nova Prova</h2>

    <form th:action="@{/provas/salvar}" th:object="${prova}" method="post" class="mt-4">
        <input type="hidden" th:field="*{id}"/>

        <div class="mb-3">
            <label class="form-label" for="titulo">Título</label>
            <input class="form-control" id="titulo" type="text" th:field="*{titulo}" required />
        </div>

        <div class="mb-3">
            <label class="form-label" for="data">Data</label>
            <input class="form-control" id="data" name="data" type="date"
                   th:value="${prova.data != null ? #temporals.format(prova.data, 'yyyy-MM-dd') : ''}" required />

            <div id="avisoData" class="alert alert-warning mt-2" style="display: none;" role="alert">
                <i class="bi bi-exclamation-triangle-fill"></i>
                <strong>Atenção:</strong> A data selecionada é anterior à data de hoje.
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label" for="disciplina">Disciplina</label>
            <select class="form-select" id="disciplina" th:field="*{disciplina.id}" required>
                <option disabled selected value="0" >Selecione...</option>
                <option th:each="disciplina : ${disciplinas}"
                        th:value="${disciplina.id}"
                        th:text="${disciplina.nome}"></option>
            </select>
        </div>

        <button type="submit" class="btn btn-success"><i class="bi bi-save"></i> Salvar</button>
        <a th:href="@{/provas}" class="btn btn-secondary ms-2">Cancelar</a>
    </form>
</div>

<script th:src="@{/js/sidebar-toggle.js}"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const inputData = document.getElementById('data');
        const aviso = document.getElementById('avisoData');

        function verificarData() {
            if (!inputData.value) {
                aviso.style.display = 'none';
                return;
            }
            const partes = inputData.value.split('-');
            const dataSelecionada = new Date(partes[0], partes[1] - 1, partes[2]);
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);

            if (dataSelecionada < hoje) {
                aviso.style.display = 'block';
            } else {
                aviso.style.display = 'none';
            }
        }
        inputData.addEventListener('change', verificarData);
        verificarData();
    });
</script>

</body>
</html>